WITH T1 AS
(
	select prod, quant,count(quant)
	from sales
	group by prod,quant
	order by prod, quant
),
T2 AS
(
	SELECT S.PROD,S.QUANT,COUNT(S1.QUANT) SMALLER
	FROM SALES AS S,SALES AS S1
	WHERE S.PROD = S1.PROD
	AND S.QUANT >= S1.QUANT
	GROUP BY S.PROD,S.QUANT
	ORDER BY S.PROD,S.QUANT
),
T3 AS
(
	SELECT S.PROD,S.QUANT,COUNT(S1.QUANT) BIGGER
	FROM SALES AS S,SALES AS S1
	WHERE S.PROD = S1.PROD
	AND S.QUANT <= S1.QUANT
	GROUP BY S.PROD,S.QUANT
	ORDER BY S.PROD,S.QUANT
),
T4 AS
(
	SELECT T2.PROD,T2.QUANT,SMALLER/COUNT AS SMALLER
	FROM T1,T2
	WHERE T1.PROD=T2.PROD
	AND T1.QUANT=T2.QUANT
),
T5 AS
(
	SELECT T3.PROD,T3.QUANT,BIGGER/COUNT AS BIGGER
	FROM T1,T3
	WHERE T1.PROD=T3.PROD
	AND T1.QUANT=T3.QUANT
),
T6 AS
(
	select prod,count(quant)/2 as mid
	from sales
	group by prod
	order by prod
)
SELECT T5.PROD AS PRODUCT,BIGGER AS "MEDIAN QUANT"
FROM T5,T6 
WHERE T5.PROD = T6.PROD
AND T5.BIGGER = T6.mid